<!DOCTYPE html>
<html lang="tr">
<head>
 <meta charset="UTF-8" />
 <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
 <link rel="icon" type="image/x-icon" href="favicon.png">
 <title>Yükleniyor...</title>
 <style>
  html, body {
   height: 100%;
   margin: 0;
   padding: 0;
  }
  body {
   font-family: 'Segoe UI', sans-serif;
   background: #f4f6f9;
   padding: 1rem;
   color: #333;
   display: flex;
   flex-direction: column;
   min-height: 100vh;
   box-sizing: border-box;
  }
  h1 {
   text-align: center;
   color: #2c3e50;
  }
  table {
   width: 100%;
   border-collapse: collapse;
   margin-top: 1.5rem;
   background: white;
   box-shadow: 0 0 10px rgba(0,0,0,0.05);
  }
  th, td {
   padding: 0.8rem;
   text-align: left;
   border-bottom: 1px solid #eee;
  }
  th {
   background-color: #2c3e50;
   color: white;
  }
  .asil {
   background-color: #d4edda;
   color: #155724;
   font-weight: bold;
  }
  .yedek {
   background-color: #fff3cd;
   color: #856404;
   font-weight: bold;
  }
  #aciklama {
   margin-top: 2rem;
   padding: 1rem;
   background: #e9ecef;
   border-radius: 5px;
   color: #495057;
   text-align: center;
  }
  #logolar {
   display: block;
   margin: 0 auto 2rem auto;
   max-width: 400px;
   height: auto;
  }
  footer {
   margin-top: auto;
   padding: 10px;
   text-align: center;
   background-color: #34495e;
   color: #ecf0f1;
   font-size: 14px;
   border-top: 1px solid #2c3e50;
  }
  footer p {
   margin: 0;
  }
  #sayac {
   position: fixed;
   top: 10px;
   right: 10px;
   background-color: #2c3e50;
   color: white;
   padding: 3px 4px;
   border-radius: 5px;
   font-size: 14px;
   z-index: 1000;
   box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  }
  @media (max-width: 500px) {
    #sayac{
      padding: 2px 4px;
      font-size: 10px;
    }
   #logolar {
    max-width: 300px;
   }
  }
  @media (max-width: 200px) {
   table, thead, tbody, th, td, tr {
    display: block;
   }
   tr {
    margin-bottom: 1rem;
   }
   th {
    display: none;
   }
   td {
    padding: 0.5rem;
    border: none;
    position: relative;
   }
   td::before {
    content: attr(data-label);
    font-weight: bold;
    display: block;
    margin-bottom: 0.2rem;
   }
   #sayac {
    top: 5px;
    right: 5px;
    font-size: 12px;
    padding: 3px 6px;
   }
  }
 </style>
</head>
<body>
 
 <img id="logolar" src="logolar.png">
 
 <h1 id="mainTitle"></h1>
 
 <div id="sayac">Yenileniyor...</div>

 <table>
  <thead>
   <tr>
    <th>#</th>
    <th>Ad Soyad</th>
    <th>Durum</th>
   </tr>
  </thead>
  <tbody id="katilimciListesi">
   <tr><td colspan="3">Yükleniyor...</td></tr>
  </tbody>
 </table>
 
 <div id="aciklama">
  </div>
 
 <footer>
  <p id="footerText">Bu tablo resmi bir belge niteliği taşımaz. Sadece bilgilendirme amaçlıdır.</p>
 </footer>
 
 <script>
  const defaultSettings = {
    sheetyLink: "", 
    pageTitle: "Katılımcı Listesi",
    asilCount: 2,
    totalParticipantsToShow: 1,
    explanation: "",
    logoUrl: "logolar.png"
  };
  let settings = {};
  try {
    const storedSettings = localStorage.getItem('listPageSettings');
    if (storedSettings) {
      settings = { ...defaultSettings, ...JSON.parse(storedSettings) };
    } else {
      settings = defaultSettings;
    }
  } catch (e) {
    console.error("localStorage'dan ayarlar yüklenirken hata oluştu, varsayılanlar kullanılacak.", e);
    settings = defaultSettings;
  }
  document.title = settings.pageTitle;
  document.getElementById("mainTitle").textContent = settings.pageTitle;
  document.getElementById("aciklama").innerHTML = settings.explanation;
  document.getElementById("logolar").src = settings.logoUrl;
    
    // Geri sayım sayacı için değişkenler ve fonksiyon
    const sayacElement = document.getElementById("sayac");
    const reloadInterval = 60;
    let remainingTime = reloadInterval;

    function updatesayac() {
      remainingTime--;
      sayacElement.textContent = `Güncelleme: ${remainingTime}s`;

      if (remainingTime <= 0) {
        remainingTime = reloadInterval; // Sayacı sıfırla
        location.reload(); // Sayfayı yenile
      }
    }
    // Her saniye geri sayımı güncelle
    setInterval(updatesayac, 1000);

  // Listeyi çek ve doldur
  fetch(settings.sheetyLink)
   .then(response => {
     if (!response.ok) {
       throw new Error(`HTTP error! Status: ${response.status} - Lütfen Sheety API linkinizi kontrol edin.`);
     }
     return response.json();
   })
   .then(data => {
    console.log("Sheety API Yanıtı:", data);

    const sheetNames = Object.keys(data);
    if (sheetNames.length === 0) {
      throw new Error("API yanıtında beklenen sayfa verisi bulunamadı (yanıt boş veya hatalı).");
    }
    const sheetName = sheetNames[0];

    const liste = data[sheetName];

    if (!Array.isArray(liste)) {
      throw new Error(`API yanıtında '${sheetName}' anahtarı altında liste (Array) bulunamadı. Lütfen Sheety yanıt yapısını kontrol edin.`);
    }

    const tbody = document.getElementById("katilimciListesi");
    tbody.innerHTML = '';

    liste.forEach((kisi, index) => {
     if (index >= settings.totalParticipantsToShow) return;

     const tr = document.createElement("tr");
     let durumMetni = "";
     let durumClass = "";

     if (index < settings.asilCount) {
      durumMetni = "Asil";
      durumClass = "asil";
     } else {
      durumMetni = `${index - settings.asilCount + 1}.Yedek `;
      durumClass = "yedek";
     }

     tr.className = durumClass;

     let kisiAdi = kisi['adSoyad:'] || kisi['adSoyad'] || '-';

     tr.innerHTML = `
      <td data-label="#">${index + 1}</td>
      <td data-label="Ad Soyad">${kisiAdi}</td>
      <td data-label="Durum">${durumMetni}</td>
     `;
     tbody.appendChild(tr);
    });
   })
   .catch(error => {
    document.getElementById("katilimciListesi").innerHTML =
     `<tr><td colspan='3'>Veri yüklenirken hata oluştu: ${error.message}. <br>Lütfen Sheety API linkinizi, Sheety'deki sayfa adını ve kolon adlarını kontrol edin. Konsola bakın.</td></tr>`;
    document.getElementById("mainTitle").textContent = "Hata Oluştu!";
    document.getElementById("aciklama").innerHTML = `<p>Katılımcı verileri yüklenemedi. Detay: ${error.message}</p>`;
    console.error("Hata:", error);
   });
 </script>
</body>
</html>